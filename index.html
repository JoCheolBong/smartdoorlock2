<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Capstone Website Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=0c43dda5249fa5372cb6f65f0320a50f&autoload=false"></script>
</head>
<body>

  <!-- 사용자 목록 -->
  <div id="userList">
    <h2>사용자 목록</h2>
    <div class="user" data-name="12345678">12345678</div>
  </div>

  <!-- 사용자 정보 -->
  <div id="userInfo" class="hidden">
    <div class="info-header">
      <h2>사용자 정보</h2>
      <button onclick="closeUserInfo()">X</button>
    </div>
    <div id="infoArea">사용자를 선택해주세요.</div>
  </div>

  <!-- 지도 -->
  <div id="mapArea">
    <h2>지오펜스 화면</h2>
    <p id="mapUser">사용자를 선택하면 지오펜스가 표시됩니다.</p>
    <div id="map"></div>
  </div>

  <script>
    const userData = {
      '12345678': [
        { lat: 36.3307729, lng: 127.3364228 },
        { lat: 36.3306827, lng: 127.3366801 },
        { lat: 36.3304827, lng: 127.3367801 },
        { lat: 36.3303827, lng: 127.3368801 },
        { lat: 36.3301827, lng: 127.3370801 },
        { lat: 36.3300000, lng: 127.3371801 }
      ]
    };

    let map;
    let markers = [];

    function initMap() {
      const container = document.getElementById('map');
      map = new kakao.maps.Map(container, {
        center: new kakao.maps.LatLng(36.3307729, 127.3364228),
        level: 4
      });

      const mapTypeControl = new kakao.maps.MapTypeControl();
      map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

      const zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

      document.querySelectorAll('.user').forEach(el => {
        el.addEventListener('click', () => selectUser(el.dataset.name));
      });
    }

    function selectUser(userId) {
      const positions = userData[userId] || [];
      const infoArea = document.getElementById('infoArea');
      const logHtml = positions.map(pos => `
        <div class="log-entry">
          <strong>위도:</strong> ${pos.lat}<br>
          <strong>경도:</strong> ${pos.lng}
        </div>
      `).join('');

      infoArea.innerHTML = `
        <p><strong>사용자 ID:</strong> ${userId}</p>
        <h3>위치 목록</h3>
        <div class="log-list">${logHtml}</div>
      `;
      document.getElementById('userInfo').classList.remove('hidden');
      document.getElementById('mapUser').textContent = `${userId}의 지오펜스 화면입니다.`;

      // 기존 마커 제거
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      // 새 마커 찍기
      positions.forEach((pos, index) => {
        const marker = new kakao.maps.Marker({
          position: new kakao.maps.LatLng(pos.lat, pos.lng),
          map: map,
          title: `위치 ${index + 1}`,
          draggable: true
        });
        markers.push(marker);
      });

      // 첫 번째 마커로 중심 이동
      if (positions.length > 0) {
        map.setCenter(new kakao.maps.LatLng(positions[0].lat, positions[0].lng));
      }
    }

    function closeUserInfo() {
      document.getElementById('userInfo').classList.add('hidden');
      document.getElementById('infoArea').innerHTML = '사용자를 선택해주세요.';
    }

    document.addEventListener('DOMContentLoaded', () => {
      kakao.maps.load(initMap);
    });
  </script>
</body>
</html>
